{"slots":{"0":{"name":"DB","type":{"events":[],"methods":[]}},"1":{"name":"SCREEN_A","type":{"events":[],"methods":[]}},"2":{"name":"slot3","type":{"events":[],"methods":[]}},"3":{"name":"slot4","type":{"events":[],"methods":[]}},"4":{"name":"slot5","type":{"events":[],"methods":[]}},"5":{"name":"slot6","type":{"events":[],"methods":[]}},"6":{"name":"slot7","type":{"events":[],"methods":[]}},"7":{"name":"slot8","type":{"events":[],"methods":[]}},"8":{"name":"slot9","type":{"events":[],"methods":[]}},"9":{"name":"slot10","type":{"events":[],"methods":[]}},"-1":{"name":"unit","type":{"events":[],"methods":[]}},"-2":{"name":"system","type":{"events":[],"methods":[]}},"-3":{"name":"library","type":{"events":[],"methods":[]}}},"handlers":[{"code":"system.print(\"START\")\nreload()\nunit.setTimer(\"reload\", 5)\nunit.stopTimer(\"start\")","filter":{"args":[{"value":"start"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"0"},{"code":"  clearSCREEN()","filter":{"args":[],"signature":"stop()","slotKey":"-1"},"key":"1"},{"code":"system.print(\"RELOAD\")\ncheckdb()","filter":{"args":[{"value":"reload"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"2"},{"code":"-- FACTORY HUD v1.1 by carmo\n\n-- Any questions please contact carmo#1590 on discord\n-- THIS CODE NEEDS TO BE PLACED ON A MAIN BOARD TO READ DB AND DISPLAY SCREEN\n\n-- SYSTEM VARS\nlocal refresh_in_sec = 1 --export\nlocal varoff = 0\nlocal ContainerCapacity = 153600 --export\n\n--readout HTML\nlocal material_readout_top = [[\n<style> \n.table {background-color:none; height:99vh; margin:auto; padding:0; position:relative; width:98vw} \n.column_left {background-color:none; position:absolute; left:20px; height:100%; width:45vw} \n.column_right {background-color:none; position:absolute; right:0; height:100%; width:45vw} \n.row {background-color:none; height:9.8vh; border:0px grey solid; padding-left:35%; width:99%} \n.name {background-color:none; padding-left:10px; line-height:5vh; font-size: 4vh; display:inline-block; width:70%} \n.progressbar {background-color:green; position:relative; float:right; bottom:2px; min-height:1vh; height:1vh; right:0; min-width:1vw}\n.daysavailable {width:100%; background-color:none; position:relative; float:left; text-align:right; bottom:2px; height:2vh;font-size:12px}\n.percentage {background-color:none; font-size: 5vh; line-height: 5vh; width:30%; top: 0; right: 0; text-align:right; display:inline-block} \n</style> \n<div class=\"table\"> \n\t<div class=\"column_left\"> ]]\n\nfunction material_readout_cell(name, percentage)\n     html = [[\n<div class=\"row\"> \n\t<div class=\"name\">]]..name..[[</div><div class=\"percentage\">]]..percentage..[[%</div>\n\t<div class=\"progressbar\" style=\"width:]]..percentage..[[%; background-color:]]..progresscolor(percentage)..[[\">&nbsp;</div>\n</div> ]]\n    return html\nend\n\nlocal material_readout_middle = [[</div><div class=\"column_right\">]]\nlocal material_readout_bottom = [[</div></div>]]\n\nfunction progresscolor(percentage)\n    color = \"\"\n    if (percentage<=2) then\n        color = \"red\"\n    elseif (percentage >2) and (percentage <5) then\n        color = \"yellow\"\n    else\n        color = \"green\"\n    end\n    return color\nend\n\nfunction round(x)\n  return x>=0 and math.floor(x+0.5) or math.ceil(x-0.5)\nend\n\nfunction containerPercentage(materialqtd)\n    if materialqtd ~= nil then\n\t\treturn round((materialqtd*100)/ContainerCapacity)\n    else\n    \treturn 666\n    end\nend\n\nfunction create_material_readout()   \n   html = material_readout_top\n   html = html .. material_readout_cell(\"HEMATITE\", containerPercentage(vHEMATITE))\n   html = html .. material_readout_cell(\"BAUXITE\", containerPercentage(vBAUXITE))\n   html = html .. material_readout_cell(\"COAL\", containerPercentage(vCOAL))\n   html = html .. material_readout_cell(\"QUARTZ\", containerPercentage(vQUARTZ))\n   html = html .. material_readout_cell(\"LIMESTONE\", containerPercentage(vLIMESTONE))\n   html = html .. material_readout_cell(\"ACANTHITE\", containerPercentage(vACANTHITE))\n   html = html .. material_readout_cell(\"MALACHITE\", containerPercentage(vMALACHITE))\n   html = html .. material_readout_cell(\"NATRON\", containerPercentage(vNATRON))\n   html = html .. material_readout_cell(\"PYRITE\", containerPercentage(vPYRITE))\n   html = html .. material_readout_cell(\"PETALITE\", containerPercentage(vPETALITE))\n   html = html .. material_readout_middle\n   html = html .. material_readout_cell(\"IRON\", containerPercentage(vIRON))\n   html = html .. material_readout_cell(\"ALUMINIUM\", containerPercentage(vALUMINIUM))\n   html = html .. material_readout_cell(\"CARBON\", containerPercentage(vCARBON))\n   html = html .. material_readout_cell(\"SILICON\", containerPercentage(vSILICON))\n   html = html .. material_readout_cell(\"CALCIUM\", containerPercentage(vCALCIUM))\n   html = html .. material_readout_cell(\"SILVER\", containerPercentage(vSILVER))\n   html = html .. material_readout_cell(\"COPPER\", containerPercentage(vCOPPER))\n   html = html .. material_readout_cell(\"SODIUM\", containerPercentage(vSODIUM))\n   html = html .. material_readout_cell(\"SULFUR\", containerPercentage(vSULFUR))\n   html = html .. material_readout_cell(\"LITHIUM\", containerPercentage(vLITHIUM))\n   html = html .. material_readout_bottom     \n   return html \nend\n\nfunction clearSCREEN()\n   -- clear screens\n  SCREEN_A.clear()\nend\n\nfunction readDB()\n  --ores\n  vQUARTZ = DB.getIntValue(\"dbQUARTZ\")\n  vACANTHITE = DB.getIntValue(\"dbACANTHITE\")\n  vCOAL = DB.getIntValue(\"dbCOAL\")\n  vPETALITE = DB.getIntValue(\"dbPETALITE\")\n  vMALACHITE = DB.getIntValue(\"dbMALACHITE\")\n  vHEMATITE = DB.getIntValue(\"dbHEMATITE\")\n  vLIMESTONE = DB.getIntValue(\"dbLIMESTONE\")\n  vNATRON = DB.getIntValue(\"dbNATRON\")\n  vBAUXITE = DB.getIntValue(\"dbBAUXITE\")\n  vPYRITE = DB.getIntValue(\"dbPYRITE\")\n  --pures\n  vALUMINIUM = DB.getIntValue(\"dbALUMINIUM\")\n  vSILICON = DB.getIntValue(\"dbSILICON\")\n  vSULFUR = DB.getIntValue(\"dbSULFUR\")\n  vSODIUM = DB.getIntValue(\"dbSODIUM\")\n  vLITHIUM = DB.getIntValue(\"dbLITHIUM\")\n  vSILVER = DB.getIntValue(\"dbSILVER\")\n  vCALCIUM = DB.getIntValue(\"dbCALCIUM\")\n  vCOPPER = DB.getIntValue(\"dbCOPPER\")\n  vCARBON = DB.getIntValue(\"dbCARBON\")\n  vIRON = DB.getIntValue(\"dbIRON\")\n\n  --set db to read status\n  DB.setIntValue(\"dbstatus\",0)\nend\n\nfunction checkreload()\n  if DB.getIntValue(\"dbstatus\") == 1 then reload() end\nend\n\nfunction checkdb()\n   varoff = varoff + 1\n   if DB.getIntValue(\"dbstatus\") < 1 then\n     system.print(\"DB CHANGED\")\n     reload()\n     DB.setIntValue(\"dbstatus\",varoff)\n   end\nend\n\nfunction door()\n    local playerId = unit.getMasterPlayerId() \n    local playerName = system.getPlayerName(playerId) \n    local t = {'playername1', 'playername2'} \n    local function has_value (tab, val) \n        for index, value in ipairs(tab) do \n            if value == val then \n                return true \n            end \n        end \n        return false \n    end \n    system.print(\"Hello \" .. playerName .. \" : \" .. playerId .. \"!\") \n    if has_value(t, playerName) then \n        if DOOR1 ~= nil then\n        \tDOOR1.activate() \n        \tDOOR2.activate()\n        \t--SCREEN.setCenteredText(\"WELCOME\" .. playerName) \n        end\n    else \n        system.print('NOPE')\n    end\nend\n\nfunction reload()\n  clearSCREEN()\n  readDB()\n  \n  -- main div\n  html = [[ <div style=\"width=100vw\">]]\n  html = html .. [[ <div style=\"margin-top: 10px;padding: 0px;width: 100vw;display: inline-block;\"> ]]\n  html = html .. create_material_readout()\n  html = html .. [[</div></div>]] \n \n  -- html to screens  \n  SCREEN_A.setHTML(html)\nend\n\n--start factory\nunit.setTimer(\"start\", refresh_in_sec)\n--if has a door, open it\nif DOOR1 ~= nil then door() end","filter":{"args":[],"signature":"start()","slotKey":"-2"},"key":"3"},{"code":"if DOOR1 ~= nil then\n\tif DOOR1.getState() == 1 then  \n    \tDOOR1.deactivate() \n    \t--DOOR2.deactivate()\n       \t--DOOR3 etc..\n         --DOOR4 etc...\n\tend\nend","filter":{"args":[],"signature":"stop()","slotKey":"-2"},"key":"4"}],"methods":[],"events":[]}
