{"slots":{"0":{"name":"slot1","type":{"events":[],"methods":[]}},"1":{"name":"SCREEN_A","type":{"events":[],"methods":[]}},"2":{"name":"SCREEN_B","type":{"events":[],"methods":[]}},"3":{"name":"slot4","type":{"events":[],"methods":[]}},"4":{"name":"slot5","type":{"events":[],"methods":[]}},"5":{"name":"slot6","type":{"events":[],"methods":[]}},"6":{"name":"slot7","type":{"events":[],"methods":[]}},"7":{"name":"slot8","type":{"events":[],"methods":[]}},"8":{"name":"slot9","type":{"events":[],"methods":[]}},"9":{"name":"slot10","type":{"events":[],"methods":[]}},"-1":{"name":"unit","type":{"events":[],"methods":[]}},"-2":{"name":"system","type":{"events":[],"methods":[]}},"-3":{"name":"library","type":{"events":[],"methods":[]}}},"handlers":[{"code":"system.print(\"KICKSTART\")\nrefresh_in_sec = 5 --export\nunit.setTimer(\"refresh\", refresh_in_sec)\nunit.stopTimer(\"kickstart\")\nreload()","filter":{"args":[{"value":"kickstart"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"0"},{"code":"system.print(\"RELOAD\")\nreload()","filter":{"args":[{"value":"refresh"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"1"},{"code":"-- FACTORY HUD v1.3 by carmo\n\n-- Any questions please contact carmo#1590 on discord\n-- THIS CODE NEEDS TO BE PLACED ON A MAIN BOARD TO READ DB AND DISPLAY SCREEN\n\n-- SYSTEM VARS\n\nlocal varoff = 0\nlocal ContainerLCapacity = 153600 --export\nlocal ContainerMCapacity = 64000 --export\nlocal ContainerSCapacity = 9600 --export\nlocal ContainerXSCapacity = 1200 --export\nlocal Percentage_RED = 10 --export\nlocal Percentage_GREEN = 60 --export\n\n-- DO NOT CHANGE THIS MATERIAL VARIABLES\n\nlocal m0 = \"EMPTY\"\nlocal m1 = \"HEMATITE\"\nlocal m2 = \"IRON\"\nlocal m3 = \"BAUXITE\"\nlocal m4 = \"ALUMINIUM\"\nlocal m5 = \"COAL\"\nlocal m6 = \"CARBON\"\nlocal m7 = \"QUARTZ\"\nlocal m8 = \"SILICON\"\nlocal m9 = \"LIMESTONE\"\nlocal m10 = \"CALCIUM\"\nlocal m11 = \"ACANTHITE\"\nlocal m12 = \"SILVER\"\nlocal m13 = \"MALACHITE\"\nlocal m14 = \"COPPER\"\nlocal m15 = \"NATRON\"\nlocal m16 = \"SODIUM\"\nlocal m17 = \"PYRITE\"\nlocal m18 = \"SULFUR\"\nlocal m19 = \"PETALITE\"\nlocal m20 = \"LITHIUM\"\nlocal m21 = \"CHROMITE\"\nlocal m22 = \"CHROMIUM\"\nlocal m23 = \"GARNIERITE\"\nlocal m24 = \"NICKEL\"\nlocal m25 = \"GOLDNUGGETS\"\nlocal m26 = \"GOLD\"\nlocal m27 = \"RHODONITE\"\nlocal m28 = \"MANGANESE\"\n\n\n--On this next arrays you will place witch order you like\n--Read always left to right, then next line.\n--YOU CAN SET m0 if you need a blank space\n\nlocal SCREENA = {m1,m2,m3,m4,m5,m6,m7,m8,m9,m10,m11,m12,m13,m14,m15,m16,m17,m18,m19,m20}\nlocal SCREENB = {m21,m22,m23,m24,m25,m26,m27,m28}\n\n--readout HTML\nlocal material_readout_top = [[\n<style> \n.table {background-color:none; height:99vh; margin:auto; padding:0; position:relative; width:98vw} \n.column_left {background-color:none; position:absolute; left:20px; height:100%; width:45vw} \n.column_right {background-color:none; position:absolute; right:0; height:100%; width:45vw} \n.row {background-color:none; height:9.8vh; border:0px grey solid; padding-left:35%; width:99%} \n.name {background-color:none; padding-left:10px; line-height:5vh; font-size: 4vh; display:inline-block; width:70%} \n.progressbar {background-color:green; position:relative; float:right; bottom:2px; min-height:1vh; height:1vh; right:0; min-width:1vw}\n.daysavailable {width:100%; background-color:none; position:relative; float:left; text-align:right; bottom:2px; height:2vh;font-size:12px}\n.percentage {background-color:none; font-size: 5vh; line-height: 5vh; width:30%; top: 0; right: 0; text-align:right; display:inline-block} \n</style> \n<div class=\"table\"> \n\t<div class=\"column_left\"> ]]\n\nfunction material_readout_cell(name)\n    if name == nil then \n          html = [[\n<div class=\"row\"> \n\t<div class=\"name\"></div><div class=\"percentage\"></div>\n\t<div class=\"progressbar\" style=\"width:0%; background-color:pink\">&nbsp;</div>\n</div> ]] \n    else\n\tpercentage = getMaterialQuantity(name)\n        if name == \"loading\" then\n        html = [[\n<div class=\"row\"> \n\t<div class=\"name\">LOADING</div><div class=\"percentage\">LOADING</div>\n\t<div class=\"progressbar\" style=\"width:0%; background-color:pink\">&nbsp;</div>\n</div> ]]   \n    else\n     html = [[\n<div class=\"row\"> \n\t<div class=\"name\">]]..name..[[</div><div class=\"percentage\">]]..percentage..[[%</div>\n\t<div class=\"progressbar\" style=\"width:]]..percentage..[[%; background-color:]]..progresscolor(percentage)..[[\">&nbsp;</div>\n</div> ]]\n    end\n  end\n    return html\nend\n\nlocal material_readout_middle = [[</div><div class=\"column_right\">]]\nlocal material_readout_bottom = [[</div></div>]]\n\nfunction round(x)\n  return x>=0 and math.floor(x+0.5) or math.ceil(x-0.5)\nend\n\nfunction print_r(arr, indentLevel)\n    local str = \"\"\n    local indentStr = \"#\"\n\n    if(indentLevel == nil) then\n        system.print(print_r(arr, 0))\n        return\n    end\n\n    for i = 0, indentLevel do\n        indentStr = indentStr..\"\\t\"\n    end\n\n    for index,value in pairs(arr) do\n        if type(value) == \"table\" then\n            str = str..indentStr..index..\": \\n\"..print_r(value, (indentLevel + 1))\n        else \n            str = str..indentStr..index..\": \"..value..\"\\n\"\n        end\n    end\n    return str\nend\n\ncore = nil\nfor slot_name, slot in pairs(unit) do\n    if\n        type(slot) == \"table\"\n        and type(slot.export) == \"table\"\n        and slot.getElementClass\n    then\n        if slot.getElementClass():lower():find(\"coreunit\") then\n            core = slot\n        end\n    end\nend\n\ncontainersIdList = {}\nif core ~= nil then\n     local elementsIdList = core.getElementIdList()\n     for _,id in pairs(elementsIdList) do\n        local elementType = core.getElementTypeById(id):lower()\n        if elementType:find(\"container hub\") then\n\t\t  name = core.getElementNameById(id)\n            if string.match(name, \"CH_\") then   \n               --1: id, 2: containercount, 3: containersize, 4: material\n               --system.print(\"1: \"..id..\", 2: \"..name:sub(4,4)..\", 3: \"..name:sub(5,5)..\", 4: \"..name:sub(7))\n \t\t  \ttable.insert(containersIdList , {id, name:sub(4,4), name:sub(5,5), name:sub(7)})             \n\t\tend                        \n        end\n     end\nend\n\nfunction createMaterialArray(material)\n    arrayX = {}\n    for i,j in pairs(containersIdList) do\n        if j[4] == material then table.insert(arrayX, {j[1], j[2], j[3], j[4]}) end\n    end\n    return arrayX\nend\n\nfunction getContainerMass(size)\n   mass = 0\n    if size == \"L\" then mass = ContainerLCapacity\n    elseif size == \"M\" then mass = ContainerMCapacity\n    elseif size == \"S\" then mass = ContainerSCapacity\n    elseif size == \"XS\" then mass = ContainerXSCapacity\n    else\n       mass = 0\n    end\n    return mass \nend\n\nfunction getQuantity(material, mass)\n   quantity = nil\n   if material == \"IRON\" then quantity = round(mass / 7.85)\n   elseif material == \"ALUMINIUM\" then quantity = round(mass / 2.7)\n   elseif material == \"SILICON\" then quantity = round(mass / 2.33)\n   elseif material == \"SULFUR\" then quantity = round(mass / 1.82)\n   elseif material == \"SODIUM\" then quantity = round(mass / 0.97)\n   elseif material == \"LITHIUM\" then quantity = round(mass / 0.53)\n   elseif material == \"SILVER\" then quantity = round(mass / 10.49)\n   elseif material == \"CALCIUM\" then quantity = round(mass / 1.55)\n   elseif material == \"COPPER\" then quantity = round(mass / 8.96)\n   elseif material == \"CARBON\" then quantity = round(mass / 2.27)\n   elseif material == \"QUARTZ\" then quantity = round(mass / 2.65)\n   elseif material == \"BAUXITE\" then quantity = round(mass / 1.28)\n   elseif material == \"COAL\" then quantity = round(mass / 1.35)\n   elseif material == \"HEMATITE\" then quantity = round(mass / 5.04)\n   elseif material == \"MALACHITE\" then quantity = round(mass / 4)\n   elseif material == \"LIMESTONE\" then quantity = round(mass / 2.711)\n   elseif material == \"NATRON\" then quantity = round(mass / 1.55)\n   elseif material == \"ACANTHITE\" then quantity = round(mass / 7.2)\n   elseif material == \"PETALITE\" then quantity = round(mass / 2.41)\n   elseif material == \"CHROMITE\" then quantity = round(mass / 4.54)\n   elseif material == \"CHROMIUM\" then quantity = round(mass / 7.19)\n   elseif material == \"GARNIERITE\" then quantity = round(mass / 2.6)\n   elseif material == \"NICKEL\" then quantity = round(mass / 8.91)\n   elseif material == \"GOLD\" then quantity = round(mass / 19.3)\n   elseif material == \"GOLDNUGGETS\" then quantity = round(mass / 19.3)\n   elseif material == \"RHODONITE\" then quantity = round(mass / 3.76)\n   elseif material == \"MANGANESE\" then quantity = round(mass / 7.21)\n   else \n     quantity = 666\n   end    \n   return quantity\nend\n\nfunction getMass(arrayx)\n    mass = 0\n    percentage = 0\n    for i,j in pairs(arrayx) do\n     hubmass = core.getElementMassById(j[1])\n     containermass = round(getContainerMass(j[3])*j[2])\n     mass = (containermass - math.floor(hubmass))\n     quantity = getQuantity(j[4], hubmass)\n     percentage = containerPercentage(quantity, containermass)   \n    end\n    return percentage\nend\n\nfunction containerPercentage(materialqtd, containercapacity)\n    if materialqtd ~= nil then\n\t\treturn round((materialqtd*100)/containercapacity)\n    else\n    \treturn 666\n    end\nend\n\nfunction getMaterialQuantity(material)\n    arrayX = createMaterialArray(material)\n    return getMass(arrayX)\nend\n\nfunction progresscolor(percentage)\n    color = \"\"\n    if (percentage<=Percentage_RED) then\n        color = \"red\"\n    elseif (percentage >Percentage_RED) and (percentage <Percentage_GREEN) then\n        color = \"yellow\"\n    else\n        color = \"green\"\n    end\n    return color\nend\n\nfunction create_material_readout_screen_A()   \n   html = material_readout_top\n   html = html .. material_readout_cell(SCREENA[1])\n   html = html .. material_readout_cell(SCREENA[3])\n   html = html .. material_readout_cell(SCREENA[5])\n   html = html .. material_readout_cell(SCREENA[7])\n   html = html .. material_readout_cell(SCREENA[9])\n   html = html .. material_readout_cell(SCREENA[11])\n   html = html .. material_readout_cell(SCREENA[13])\n   html = html .. material_readout_cell(SCREENA[15])\n   html = html .. material_readout_cell(SCREENA[17])\n   html = html .. material_readout_cell(SCREENA[19])\n   html = html .. material_readout_middle\n   html = html .. material_readout_cell(SCREENA[2])\n   html = html .. material_readout_cell(SCREENA[4])\n   html = html .. material_readout_cell(SCREENA[6])\n   html = html .. material_readout_cell(SCREENA[8])\n   html = html .. material_readout_cell(SCREENA[10])\n   html = html .. material_readout_cell(SCREENA[12])\n   html = html .. material_readout_cell(SCREENA[14])\n   html = html .. material_readout_cell(SCREENA[16])\n   html = html .. material_readout_cell(SCREENA[18])\n   html = html .. material_readout_cell(SCREENA[20])\n   html = html .. material_readout_bottom     \n   return html \nend\n\nfunction create_material_readout_screen_B()   \n   html = material_readout_top\n   html = html .. material_readout_cell(SCREENB[1])\n   html = html .. material_readout_cell(SCREENB[3])\n   html = html .. material_readout_cell(SCREENB[5])\n   html = html .. material_readout_cell(SCREENB[7])\n   html = html .. material_readout_cell(SCREENB[9])\n   html = html .. material_readout_cell(SCREENB[11])\n   html = html .. material_readout_cell(SCREENB[13])\n   html = html .. material_readout_cell(SCREENB[15])\n   html = html .. material_readout_cell(SCREENB[17])\n   html = html .. material_readout_cell(SCREENB[19])\n   html = html .. material_readout_middle\n   html = html .. material_readout_cell(SCREENB[2])\n   html = html .. material_readout_cell(SCREENB[4])\n   html = html .. material_readout_cell(SCREENB[6])\n   html = html .. material_readout_cell(SCREENB[8])\n   html = html .. material_readout_cell(SCREENB[10])\n   html = html .. material_readout_cell(SCREENB[12])\n   html = html .. material_readout_cell(SCREENB[14])\n   html = html .. material_readout_cell(SCREENB[16])\n   html = html .. material_readout_cell(SCREENB[18])\n   html = html .. material_readout_cell(SCREENB[20])\n   html = html .. material_readout_bottom     \n   return html \nend\n\nfunction create_material_readout_loading()   \n   html = material_readout_top\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_middle\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_cell(\"LOADING\")\n   html = html .. material_readout_bottom     \n   return html \nend\n\n\nfunction clearSCREEN()\n   -- clear screens\n  SCREEN_A.clear()\n  if SCREEN_B ~= nil then SCREEN_B.clear() end\nend\n\nfunction reload()\n  clearSCREEN()\n  \n  -- screen A\n  html = [[ <div style=\"width:100vw\">]]\n  html = html .. [[ <div style=\"margin-top: 10px;padding: 0px;width: 100vw;display: inline-block;\"> ]]\n  html = html .. create_material_readout_screen_A()\n  html = html .. [[</div></div>]] \n \n  SCREEN_A.setHTML(html)\n  \n  -- screen B\n  html = [[<div style=\"width:100vw\">]]\n  html = html .. [[<div style=\"margin-top:10px;padding:0px;width:100vw;display:inline-block;\">]]\n  html = html .. create_material_readout_screen_B()\n  html = html .. [[</div></div>]]\n  \n  if (SCREEN_B ~= nil) then SCREEN_B.setHTML(html) end\n    \nend\n\nfunction warmup()\n  system.print(\"WARMUP\")\n  \n  -- screen A\n  html = [[<div style=\"width:100vw\">]]\n  html = html .. [[<div style=\"margin-top: 10px;padding: 0px;width: 100vw;display: inline-block;\">]]\n  html = html .. create_material_readout_loading()\n  html = html .. [[</div></div>]] \n \n  SCREEN_A.setHTML(html)\n  \n  -- screen B\n  html = [[<div style=\"width:100vw\">]]\n  html = html .. [[<div style=\"margin-top: 10px;padding: 0px;width: 100vw;display: inline-block;\">]]\n  html = html .. create_material_readout_loading()\n  html = html .. [[</div></div>]]\n  \n  if (SCREEN_B ~= nil) then SCREEN_B.setHTML(html) end\nend\n\n--start factory\nwarmup()\nunit.setTimer(\"kickstart\", 1)","filter":{"args":[],"signature":"start()","slotKey":"-2"},"key":"2"},{"code":"SCREEN_A.clear()\nSCREEN_B.clear()","filter":{"args":[],"signature":"stop()","slotKey":"-2"},"key":"3"}],"methods":[],"events":[]}